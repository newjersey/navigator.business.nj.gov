/** @type {import('dependency-cruiser').IConfiguration} */
module.exports = {
  allowedSeverity: "error",
  allowed: [
    {
      from: {},
      to: { path: "aws-amplify" },
    },
    {
      from: {},
      to: { path: "@aws-crypto/sha256-browser" },
    },
    {
      from: {},
      to: { path: "@aws-sdk/protocol-http" },
    },
    {
      from: {},
      to: { path: "@aws-sdk/s3-request-presigner" },
    },
    {
      from: {},
      to: { path: "@aws-sdk/url-parser" },
    },
    {
      from: {},
      to: { path: "@aws-sdk/util-format-url" },
    },
    {
      from: {},
      to: { path: "@businessnjgovnavigator/content/roadmaps/steps.json" },
    },
    {
      from: {},
      to: { path: "@businessnjgovnavigator/content/roadmaps/steps-domestic-employer.json" },
    },
    {
      from: {},
      to: { path: "@businessnjgovnavigator/content/roadmaps/task-dependencies.json" },
    },
    {
      from: {},
      to: { path: "@businessnjgovnavigator/shared" },
    },
    {
      from: {},
      to: { path: "@businessnjgovnavigator/shared/dateHelpers" },
    },
    {
      from: {},
      to: { path: "@jest/types" },
    },
    {
      from: {},
      to: { path: "js-yaml" },
    },
    {
      from: {},
      to: { path: "@mui/lab" },
    },
    {
      from: {},
      to: { path: "@mui/material" },
    },
    {
      from: {},
      to: { path: "@mui/styles/*" },
    },
    {
      from: {},
      to: { path: "@mui/icons-material/*" },
    },
    {
      from: {},
      to: { path: "@mui/x-date-pickers" },
    },
    {
      from: {},
      to: { path: "@storybook/react" },
    },
    {
      from: {},
      to: { path: "@testing-library/jest-dom/extend-expect" },
    },
    {
      from: {},
      to: { path: "@testing-library/react" },
    },
    {
      from: {},
      to: { path: "@testing-library/user-event" },
    },
    {
      from: {},
      to: { path: "@uswds/uswds" },
    },
    {
      from: {},
      to: { path: "axios" },
    },
    {
      from: {},
      to: { path: "broken-link-checker" },
    },
    {
      from: {},
      to: { path: "fast-deep-equal/es6/react" },
    },
    {
      from: { path: "lib" },
      to: { path: "fs" },
    },
    {
      from: { path: "scripts" },
      to: { path: "fs" },
    },
    {
      from: { path: "scripts" },
      to: { path: "airtable" },
    },
    {
      from: {},
      to: { path: "focus-trap-react" },
    },
    {
      from: {},
      to: { path: "gray-matter" },
    },
    {
      from: {},
      to: { path: "lodash" },
    },
    {
      from: {},
      to: { path: "decap-cms-app" },
    },
    {
      from: {},
      to: { path: "next" },
    },
    {
      from: {},
      to: { path: "next-seo" },
    },
    {
      from: {},
      to: { path: "next/app" },
    },
    {
      from: {},
      to: { path: "next/document" },
    },
    {
      from: {},
      to: { path: "next/dynamic" },
    },
    {
      from: {},
      to: { path: "next/link" },
    },
    {
      from: {},
      to: { path: "next/router" },
    },
    {
      from: {},
      to: { path: "next/script" },
    },
    {
      from: {},
      to: { path: "path" },
    },
    {
      from: {},
      to: { path: "querystring" },
    },
    {
      from: {},
      to: { path: "react" },
    },
    {
      from: {},
      to: { path: "react-dom" },
    },
    {
      from: {},
      to: { path: "react-dom/test-utils" },
    },
    {
      from: {},
      to: { path: "react-transition-group" },
    },
    {
      from: {},
      to: { path: "rehype-react" },
    },
    {
      from: {},
      to: { path: "remark-gfm" },
    },
    {
      from: {},
      to: { path: "rehype-format" },
    },
    {
      from: {},
      to: { path: "rehype-raw" },
    },
    {
      from: {},
      to: { path: "unist-util-visit" },
    },
    {
      from: {},
      to: { path: "remark-directive" },
    },
    {
      from: {},
      to: { path: "@types" },
    },
    {
      from: {},
      to: { path: "rehype-rewrite" },
    },
    {
      from: {},
      to: { path: "rehype-stringify" },
    },
    {
      from: {},
      to: { path: "remark-parse" },
    },
    {
      from: {},
      to: { path: "remark-rehype" },
    },
    {
      from: {},
      to: { path: "remove-markdown" },
    },
    {
      from: {},
      to: { path: "unified" },
    },
    {
      from: {},
      to: { path: "storybook-addon-designs" },
    },
    {
      from: {},
      to: { path: "swr" },
    },
    {
      from: {},
      to: { path: "url" },
    },
    {
      from: { path: "components" },
      to: { path: "lib" },
    },
    {
      from: { path: "lib/cms/previews" },
      to: { path: "pages" },
    },
    {
      from: { path: "components" },
      to: { path: "components" },
    },
    {
      from: { path: "components" },
      to: { path: "styles" },
    },
    {
      from: { path: "lib" },
      to: { path: "lib" },
    },
    {
      from: { path: "lib" },
      to: { path: "components" },
    },
    {
      from: { path: "pages" },
      to: { path: "components" },
    },
    {
      from: { path: "pages" },
      to: { path: "lib" },
    },
    {
      from: { path: "pages" },
      to: { path: "pages" },
    },
    {
      from: { path: "pages" },
      to: { path: "styles" },
    },
    {
      from: { path: "pages" },
      to: { path: "njwds" },
    },
    {
      from: {},
      to: { path: "test" },
    },
    {
      from: { path: "test" },
      to: {},
    },
    {
      from: {},
      to: { path: "../content" },
    },
    {
      from: {},
      to: { path: "dayjs" },
    },
    {
      from: { path: "../shared" },
      to: { path: "uuid" },
    },
    {
      from: { path: "" },
      to: { path: "contexts" },
    },
    {
      from: { path: "context" },
      to: { path: "lib" },
    },
    {
      from: { path: "../shared/src" },
      to: { path: "../shared/src" },
    },
    {
      from: { path: "src/scripts" },
      to: { path: "src/scripts" },
    },
    {
      from: { path: "src/scripts" },
      to: { path: "src/lib/utils" },
    },
    {
      from: { path: "src/scripts" },
      to: { path: "../shared" },
    },
  ],
  forbidden: [
    /* rules from the 'recommended' preset: */
    {
      name: "no-circular",
      severity: "error",
      comment:
        "This dependency is part of a circular relationship. You might want to revise " +
        "your solution (i.e. use dependency inversion, make sure the modules have a single responsibility) ",
      from: {},
      to: {
        circular: true,
      },
    },
    {
      name: "no-orphans",
      comment:
        "This is an orphan module - it's likely not used (anymore?). Either use it or " +
        "remove it. If it's logical this module is an orphan (i.e. it's a config file), " +
        "add an exception for it in your dependency-cruiser configuration. By default " +
        "this rule does not scrutinize dotfiles (e.g. .eslintrc.js), TypeScript declaration " +
        "files (.d.ts), tsconfig.json and some of the babel and webpack configs.",
      severity: "error",
      from: {
        orphan: true,
        pathNot: [
          "(^|/)\\.[^/]+\\.(js|cjs|mjs|ts|json)$", // dot files
          "\\.d\\.ts$", // TypeScript declaration files
          "(^|/)tsconfig\\.json$", // TypeScript config
          "(^|/)(babel|webpack)\\.config\\.(js|cjs|mjs|ts|json)$", // other configs
          "src/pages/healthz.tsx", // healthcheck page
        ],
      },
      to: {},
    },
    {
      name: "no-deprecated-core",
      comment:
        "A module depends on a node core module that has been deprecated. Find an alternative - these are " +
        "bound to exist - node doesn't deprecate lightly.",
      severity: "error",
      from: {},
      to: {
        dependencyTypes: ["core"],
        path: [
          "^(v8/tools/codemap)$",
          "^(v8/tools/consarray)$",
          "^(v8/tools/csvparser)$",
          "^(v8/tools/logreader)$",
          "^(v8/tools/profile_view)$",
          "^(v8/tools/profile)$",
          "^(v8/tools/SourceMap)$",
          "^(v8/tools/splaytree)$",
          "^(v8/tools/tickprocessor-driver)$",
          "^(v8/tools/tickprocessor)$",
          "^(node-inspect/lib/_inspect)$",
          "^(node-inspect/lib/internal/inspect_client)$",
          "^(node-inspect/lib/internal/inspect_repl)$",
          "^(async_hooks)$",
          "^(punycode)$",
          "^(domain)$",
          "^(constants)$",
          "^(sys)$",
          "^(_linklist)$",
          "^(_stream_wrap)$",
        ],
      },
    },
    {
      name: "not-to-deprecated",
      comment:
        "This module uses a (version of an) npm module that has been deprecated. Either upgrade to a later " +
        "version of that module, or find an alternative. Deprecated modules are a security risk.",
      severity: "error",
      from: {},
      to: {
        dependencyTypes: ["deprecated"],
      },
    },
    {
      name: "no-non-package-json",
      severity: "error",
      comment:
        "This module depends on an npm package that isn't in the 'dependencies' section of your package.json. " +
        "That's problematic as the package either (1) won't be available on live (2 - worse) will be " +
        "available on live with an non-guaranteed version. Fix it by adding the package to the dependencies " +
        "in your package.json.",
      from: {},
      to: {
        dependencyTypes: ["npm-no-pkg", "npm-unknown"],
        pathNot: ["njwds", "aws-amplify"],
      },
    },
    {
      name: "not-to-unresolvable",
      comment:
        "This module depends on a module that cannot be found ('resolved to disk'). If it's an npm " +
        "module: add it to your package.json. In all other cases you likely already know what to do.",
      severity: "error",
      from: {},
      to: {
        couldNotResolve: true,
      },
    },
    {
      name: "no-duplicate-dep-types",
      comment:
        "Likeley this module depends on an external ('npm') package that occurs more than once " +
        "in your package.json i.e. bot as a devDependencies and in dependencies. This will cause " +
        "maintenance problems later on.",
      severity: "error",
      from: {},
      to: {
        moreThanOneDependencyType: true,
        // as it's pretty common to have a type import be a type only import
        // _and_ (e.g.) a devDependency - don't consider type-only dependency
        // types for this rule
        dependencyTypesNot: ["type-only"],
      },
    },

    /* rules you might want to tweak for your specific situation: */
    {
      name: "not-to-spec",
      comment:
        "This module depends on a spec (test) file. The sole responsibility of a spec file is to test code. " +
        "If there's something in a spec that's of use to other modules, it doesn't have that single " +
        "responsibility anymore. Factor it out into (e.g.) a separate utility/ helper or a mock.",
      severity: "error",
      from: {},
      to: {
        path: "\\.(spec|test)\\.(js|mjs|cjs|ts|ls|coffee|litcoffee|coffee\\.md)$",
      },
    },
    {
      name: "not-to-dev-dep",
      severity: "error",
      comment:
        "This module depends on an npm package from the 'devDependencies' section of your " +
        "package.json. It looks like something that ships to production, though. To prevent problems " +
        "with npm packages that aren't there on production declare it (only!) in the 'dependencies'" +
        "section of your package.json. If this module is development only - add it to the " +
        "from.pathNot re of the not-to-dev-dep rule in the dependency-cruiser configuration",
      from: {
        path: "^(src)",
        pathNot: "\\.(spec|test)\\.(js|mjs|cjs|ts|tsx|ls|coffee|litcoffee|coffee\\.md)$",
      },
      to: {
        dependencyTypes: ["npm-dev"],
        pathNot: ["airtable"],
      },
    },
    {
      name: "optional-deps-used",
      severity: "info",
      comment:
        "This module depends on an npm package that is declared as an optional dependency " +
        "in your package.json. As this makes sense in limited situations only, it's flagged here. " +
        "If you're using an optional dependency here by design - add an exception to your" +
        "depdency-cruiser configuration.",
      from: {},
      to: {
        dependencyTypes: ["npm-optional"],
      },
    },
    {
      name: "peer-deps-used",
      comment:
        "This module depends on an npm package that is declared as a peer dependency " +
        "in your package.json. This makes sense if your package is e.g. a plugin, but in " +
        "other cases - maybe not so much. If the use of a peer dependency is intentional " +
        "add an exception to your dependency-cruiser configuration.",
      severity: "error",
      from: {},
      to: {
        dependencyTypes: ["npm-peer"],
      },
    },
  ],
  options: {
    doNotFollow: {
      path: "node_modules",
      dependencyTypes: ["npm", "npm-dev", "npm-optional", "npm-peer", "npm-bundled", "npm-no-pkg"],
    },
    tsPreCompilationDeps: true,
    tsConfig: {
      fileName: "tsconfig.json",
    },
    enhancedResolveOptions: {
      exportsFields: ["exports"],
      conditionNames: ["import", "require", "node", "default"],
    },
    reporterOptions: {
      dot: {
        collapsePattern: "node_modules/[^/]+",
      },
      archi: {
        collapsePattern: "^(packages|src|lib|app|bin|test(s?)|spec(s?))/[^/]+|node_modules/[^/]+",
      },
    },
  },
};
